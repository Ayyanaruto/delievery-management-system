"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[665],{2665:(e,s,a)=>{a.r(s),a.d(s,{default:()=>j});var r=a(5155),l=a(8803),i=a.n(l),d=a(8741),t=a.n(d);a(8413);var c=a(2115),n=a(833),o=a(5402),p=a(3710),u=a(3314),h=a(7288);delete t().Icon.Default.prototype._getIconUrl,t().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});let m=new(t()).Icon({iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],className:"pickup-marker"}),g=new(t()).Icon({iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],className:"delivery-marker"});function j(e){let{pickupAddress:s,deliveryAddress:a,pickupCoords:l,deliveryCoords:d,orders:t}=e,[j,x]=(0,c.useState)({pickup:null,delivery:null,orderMarkers:[]}),[k,y]=(0,c.useState)([28.6139,77.209]),f=async e=>{try{let s=await fetch("https://nominatim.openstreetmap.org/search?format=json&q=".concat(encodeURIComponent(e),"&limit=1")),a=await s.json();if(a&&a.length>0)return{lat:parseFloat(a[0].lat),lng:parseFloat(a[0].lon)};return null}catch(e){return console.error("Geocoding error:",e),null}},b=e=>({lat:e.coordinates[1],lng:e.coordinates[0]});return((0,c.useEffect)(()=>{(async()=>{if(!t&&s&&a){let e=null,r=null;(x({pickup:e=l&&l.coordinates&&2===l.coordinates.length?b(l):await f(s),delivery:r=d&&d.coordinates&&2===d.coordinates.length?b(d):await f(a),orderMarkers:[]}),e&&r)?y([(e.lat+r.lat)/2,(e.lng+r.lng)/2]):e?y([e.lat,e.lng]):r&&y([r.lat,r.lng])}else if(t&&t.length>0){let e=await Promise.all(t.map(async e=>{let s=null,a=null;return e.pickupAddressCord&&e.pickupAddressCord.coordinates&&Array.isArray(e.pickupAddressCord.coordinates)&&2===e.pickupAddressCord.coordinates.length?s=b(e.pickupAddressCord):e.pickupAddress&&(s=await f(e.pickupAddress)),e.deliveryAddressCord&&e.deliveryAddressCord.coordinates&&Array.isArray(e.deliveryAddressCord.coordinates)&&2===e.deliveryAddressCord.coordinates.length?a=b(e.deliveryAddressCord):e.deliveryAddress&&(a=await f(e.deliveryAddress)),{id:e._id||e.id||"",pickup:s,delivery:a,customer:e.customer,status:e.status||"assigned"}}));x({pickup:null,delivery:null,orderMarkers:e});let s=e.flatMap(e=>[e.pickup,e.delivery].filter(Boolean));s.length>0&&y([s.reduce((e,s)=>e+s.lat,0)/s.length,s.reduce((e,s)=>e+s.lng,0)/s.length])}})()},[s,a,l,d,t]),j.pickup||j.delivery||0!==j.orderMarkers.length)?(0,r.jsxs)("div",{className:"jsx-278ba96c3a503ded h-64 w-full rounded-md overflow-hidden",children:[(0,r.jsxs)(n.W,{center:k,zoom:12,style:{height:"100%",width:"100%"},className:"rounded-md",children:[(0,r.jsx)(o.e,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),j.pickup&&(0,r.jsx)(p.p,{position:[j.pickup.lat,j.pickup.lng],icon:m,children:(0,r.jsx)(u.z,{children:(0,r.jsxs)("div",{className:"jsx-278ba96c3a503ded",children:[(0,r.jsx)("strong",{className:"jsx-278ba96c3a503ded",children:"Pickup Location"}),(0,r.jsx)("br",{className:"jsx-278ba96c3a503ded"}),s]})})}),j.delivery&&(0,r.jsx)(p.p,{position:[j.delivery.lat,j.delivery.lng],icon:g,children:(0,r.jsx)(u.z,{children:(0,r.jsxs)("div",{className:"jsx-278ba96c3a503ded",children:[(0,r.jsx)("strong",{className:"jsx-278ba96c3a503ded",children:"Delivery Location"}),(0,r.jsx)("br",{className:"jsx-278ba96c3a503ded"}),a]})})}),j.pickup&&j.delivery&&(0,r.jsx)(h.R,{positions:[[j.pickup.lat,j.pickup.lng],[j.delivery.lat,j.delivery.lng]],color:"blue",weight:3,opacity:.7}),j.orderMarkers.map(e=>(0,r.jsxs)("div",{className:"jsx-278ba96c3a503ded",children:[e.pickup&&(0,r.jsx)(p.p,{position:[e.pickup.lat,e.pickup.lng],icon:m,children:(0,r.jsx)(u.z,{children:(0,r.jsxs)("div",{className:"jsx-278ba96c3a503ded",children:[(0,r.jsxs)("strong",{className:"jsx-278ba96c3a503ded",children:["Pickup for ",e.customer]}),(0,r.jsx)("br",{className:"jsx-278ba96c3a503ded"}),(0,r.jsxs)("span",{className:"jsx-278ba96c3a503ded text-xs",children:["Status: ",e.status]})]})})}),e.delivery&&(0,r.jsx)(p.p,{position:[e.delivery.lat,e.delivery.lng],icon:g,children:(0,r.jsx)(u.z,{children:(0,r.jsxs)("div",{className:"jsx-278ba96c3a503ded",children:[(0,r.jsxs)("strong",{className:"jsx-278ba96c3a503ded",children:["Delivery for ",e.customer]}),(0,r.jsx)("br",{className:"jsx-278ba96c3a503ded"}),(0,r.jsxs)("span",{className:"jsx-278ba96c3a503ded text-xs",children:["Status: ",e.status]})]})})}),e.pickup&&e.delivery&&(0,r.jsx)(h.R,{positions:[[e.pickup.lat,e.pickup.lng],[e.delivery.lat,e.delivery.lng]],color:"assigned"===e.status?"orange":"blue",weight:2,opacity:.6})]},e.id))]}),(0,r.jsx)(i(),{id:"278ba96c3a503ded",children:".pickup-marker{-webkit-filter:hue-rotate(120deg);filter:hue-rotate(120deg)}.delivery-marker{-webkit-filter:hue-rotate(240deg);filter:hue-rotate(240deg)}"})]}):(0,r.jsx)("div",{className:"h-64 bg-gray-100 rounded-md flex items-center justify-center",children:(0,r.jsx)("p",{className:"text-gray-500",children:"Unable to load map locations"})})}}}]);